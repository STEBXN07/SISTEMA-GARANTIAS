<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Garant√≠as Credisur-K (Seguro)</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #D4AF37; /* Dorado (Tipo Showroom) */
            --dark: #000;
            --card: #1a1a1a;
            --text: #fff;
            --input-bg: #333;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--dark);
            color: var(--text);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
        }

        .container { width: 100%; max-width: 900px; display: none; /* Oculto hasta login */ }

        /* PANTALLA DE LOGIN */
        #login-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: black; display: flex; flex-direction: column;
            justify-content: center; align-items: center; z-index: 999;
        }
        .pin-input {
            padding: 15px; font-size: 24px; text-align: center; letter-spacing: 10px;
            width: 150px; border-radius: 10px; border: 2px solid var(--primary);
            background: #222; color: white; margin-top: 20px;
        }

        header {
            text-align: center; border-bottom: 2px solid var(--primary);
            padding-bottom: 20px; margin-bottom: 30px;
        }
        h1 { margin: 0; color: var(--primary); text-transform: uppercase; letter-spacing: 2px; }

        .form-card {
            background-color: var(--card); padding: 25px;
            border-radius: 15px; border: 1px solid #333;
        }

        .row { display: flex; gap: 15px; flex-wrap: wrap; }
        .col { flex: 1; min-width: 250px; }

        label { display: block; margin-top: 15px; margin-bottom: 5px; color: #aaa; font-size: 14px; }
        
        input, select, textarea {
            width: 100%; padding: 12px; background-color: var(--input-bg);
            border: 1px solid #444; border-radius: 8px; color: white;
            font-size: 16px; box-sizing: border-box;
        }
        input:focus, textarea:focus { outline: none; border-color: var(--primary); }

        .btn-main {
            width: 100%; padding: 15px; margin-top: 25px;
            background-color: var(--primary); color: black;
            border: none; border-radius: 8px; font-size: 18px;
            font-weight: bold; cursor: pointer; text-transform: uppercase;
        }

        /* TABLA DE RESULTADOS */
        .garantia-item {
            background-color: var(--card); border: 1px solid #333;
            padding: 20px; margin-bottom: 15px; border-radius: 10px;
        }
        .item-header { display: flex; justify-content: space-between; align-items: center; }
        .item-details { 
            margin-top: 15px; padding-top: 15px; border-top: 1px dashed #444; 
            font-size: 14px; color: #ccc; display: none; /* Oculto por defecto */
        }
        .btn-ver {
            background: transparent; border: 1px solid var(--primary); color: var(--primary);
            padding: 5px 10px; cursor: pointer; border-radius: 5px; font-size: 12px;
        }
        .img-preview { max-width: 100%; margin-top: 10px; border-radius: 5px; border: 1px solid #555; }

    </style>
</head>
<body>

    <div id="login-screen">
        <h2 style="color:var(--primary)">SISTEMA DE SEGURIDAD</h2>
        <p>Credisur-K Admin</p>
        <input type="password" id="pin" class="pin-input" placeholder="****" maxlength="4" onkeyup="checkPin()">
        <p id="error-msg" style="color:red; display:none; margin-top:10px;">Acceso Denegado</p>
    </div>

    <div class="container" id="app">
        <header>
            <h1>Credisur-K</h1>
            <p>Gesti√≥n de Garant√≠as & Servicio T√©cnico</p>
        </header>

        <div class="form-card">
            <h3>üìù Nuevo Registro</h3>
            
            <div class="row">
                <div class="col">
                    <label>Nombre Completo del Cliente</label>
                    <input type="text" id="nombre">
                </div>
                <div class="col">
                    <label>C√©dula</label>
                    <input type="number" id="cedula">
                </div>
            </div>

            <div class="row">
                <div class="col">
                    <label>Celular 1 (Principal)</label>
                    <input type="number" id="cel1">
                </div>
                <div class="col">
                    <label>Celular 2 (Referencia)</label>
                    <input type="number" id="cel2">
                </div>
            </div>

            <label>Barrio / Direcci√≥n exacta</label>
            <input type="text" id="direccion" placeholder="Ej: B. El Jard√≠n, casa esquina blanca...">

            <div class="row">
                <div class="col">
                    <label>Producto</label>
                    <input type="text" id="producto" placeholder="Ej: Licuadora Oster">
                </div>
                <div class="col">
                    <label>Serial (Opcional)</label>
                    <input type="text" id="serial" placeholder="S/N...">
                </div>
            </div>

            <label>Descripci√≥n del Problema</label>
            <textarea id="problema" rows="3" placeholder="Ej: No prende, huele a quemado..."></textarea>

            <label>Fecha de Compra</label>
            <input type="date" id="fechaCompra">

            <label>üìÑ Subir Foto de Factura (Opcional)</label>
            <input type="file" id="factura" accept="image/*">

            <button class="btn-main" onclick="registrar()">GUARDAR CASO üíæ</button>
        </div>

        <h3 style="margin-top:40px; border-top: 1px solid #333; padding-top:20px;">üìÇ Casos Registrados</h3>
        <input type="text" id="buscador" placeholder="üîç Buscar por c√©dula o nombre..." onkeyup="buscar()" style="margin-bottom:20px;">
        
        <div id="lista"></div>
        <br><br>
        <button onclick="cerrarSesion()" style="background:#333; color:white; border:none; padding:10px;">üîí Bloquear Pantalla</button>
    </div>

    <script>
        // üîí LOGICA DE SEGURIDAD
        function checkPin() {
            const pin = document.getElementById('pin').value;
            if(pin === "2025") { // CAMBIE ESTE 2025 POR SU CLAVE
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('app').style.display = 'block';
                cargarDatos();
            }
        }

        function cerrarSesion() {
            document.getElementById('login-screen').style.display = 'flex';
            document.getElementById('app').style.display = 'none';
            document.getElementById('pin').value = '';
        }

        // üíæ LOGICA DEL SISTEMA
        async function registrar() {
            // Recoger datos
            const data = {
                id: Date.now(),
                nombre: document.getElementById('nombre').value,
                cedula: document.getElementById('cedula').value,
                cel1: document.getElementById('cel1').value,
                cel2: document.getElementById('cel2').value,
                direccion: document.getElementById('direccion').value,
                producto: document.getElementById('producto').value,
                serial: document.getElementById('serial').value,
                problema: document.getElementById('problema').value,
                fecha: document.getElementById('fechaCompra').value,
                facturaImg: null // Aqu√≠ guardaremos la foto
            };

            // Validar obligatorios
            if(!data.nombre || !data.cedula || !data.cel1 || !data.producto || !data.fecha) {
                alert("‚ö†Ô∏è Faltan datos obligatorios (Nombre, C√©dula, Celular, Producto, Fecha)");
                return;
            }

            // Procesar Imagen (Si hay)
            const fileInput = document.getElementById('factura');
            if(fileInput.files.length > 0) {
                data.facturaImg = await toBase64(fileInput.files[0]);
            }

            // Guardar
            let lista = JSON.parse(localStorage.getItem('credisur_db')) || [];
            lista.unshift(data);
            localStorage.setItem('credisur_db', JSON.stringify(lista));

            alert("‚úÖ ¬°Caso guardado con √©xito!");
            location.reload(); // Recargar para limpiar
        }

        function cargarDatos(filtro = "") {
            const contenedor = document.getElementById('lista');
            contenedor.innerHTML = "";
            let lista = JSON.parse(localStorage.getItem('credisur_db')) || [];

            // Filtro buscador
            if(filtro) {
                lista = lista.filter(item => 
                    item.nombre.toLowerCase().includes(filtro) || 
                    item.cedula.includes(filtro)
                );
            }

            lista.forEach(item => {
                // Calcular vencimiento
                const fCompra = new Date(item.fecha);
                const fVence = new Date(fCompra);
                fVence.setFullYear(fCompra.getFullYear() + 1);
                const hoy = new Date();
                const estado = hoy < fVence ? "‚úÖ VIGENTE" : "‚ùå VENCIDA";
                const colorEstado = hoy < fVence ? "#00C86F" : "#E83F5B";

                // HTML de cada tarjeta
                const html = `
                    <div class="garantia-item">
                        <div class="item-header">
                            <div>
                                <h3 style="margin:0; color:white;">${item.producto}</h3>
                                <small style="color:var(--primary)">${item.nombre} - C.C. ${item.cedula}</small>
                            </div>
                            <div style="text-align:right">
                                <b style="color:${colorEstado}">${estado}</b><br>
                                <button class="btn-ver" onclick="toggleDetalles(${item.id})">Ver Detalles ‚ñº</button>
                            </div>
                        </div>

                        <div id="detalles-${item.id}" class="item-details">
                            <p><strong>üìû Contacto:</strong> ${item.cel1} / ${item.cel2}</p>
                            <p><strong>üìç Ubicaci√≥n:</strong> ${item.direccion}</p>
                            <p><strong>üîß Problema:</strong> ${item.problema}</p>
                            <p><strong>üè∑Ô∏è Serial:</strong> ${item.serial || 'N/A'}</p>
                            <p><strong>üìÖ Vence:</strong> ${fVence.toLocaleDateString()}</p>
                            
                            ${item.facturaImg ? `<p><strong>üìÑ Factura:</strong><br><img src="${item.facturaImg}" class="img-preview"></p>` : '<p><em>Sin factura adjunta</em></p>'}
                            
                            <button onclick="borrar(${item.id})" style="color:red; background:none; border:none; margin-top:10px; cursor:pointer;">üóëÔ∏è Eliminar Caso</button>
                        </div>
                    </div>
                `;
                contenedor.innerHTML += html;
            });
        }

        // Utilidades
        function toggleDetalles(id) {
            const div = document.getElementById(`detalles-${id}`);
            div.style.display = div.style.display === 'block' ? 'none' : 'block';
        }

        function buscar() {
            const texto = document.getElementById('buscador').value.toLowerCase();
            cargarDatos(texto);
        }

        function borrar(id) {
            if(confirm("¬øSeguro que quiere borrar este caso? No se puede recuperar.")) {
                let lista = JSON.parse(localStorage.getItem('credisur_db')) || [];
                lista = lista.filter(item => item.id !== id);
                localStorage.setItem('credisur_db', JSON.stringify(lista));
                cargarDatos();
            }
        }

        const toBase64 = file => new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = () => resolve(reader.result);
            reader.onerror = error => reject(error);
        });
    </script>
</body>
</html>